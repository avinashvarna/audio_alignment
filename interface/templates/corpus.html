{% include "header.html" %}
<div class="container-fluid p-3">
    <div class="row">
        <div class="col-sm-3">
            <div class="accordion rounded scroll" id="corpus_list">
                {% set ns = namespace(expanded=false) %}
                {% if not data.corpus %}{% set ns.expanded = true %}{% endif %}
                {% for corpus in data.corpora.values() %}
                {% if data.corpus.id == corpus.id %}{% set ns.expanded = true %}{% endif %}
                <div class="accordion-item">
                    <div class="accordion-header">
                        <button class="accordion-button {% if not ns.expanded %}collapsed{% endif %}" type="button"
                            data-bs-toggle="collapse" data-bs-target="#chapter_list_{{corpus.id}}"
                            aria-expanded="{{ns.expanded}}" aria-controls="chapter_list_{{corpus.id}}">
                            {{corpus.name}}
                        </button>
                    </div>
                    <div id="chapter_list_{{corpus.id}}"
                        class="list-group list-group-flush collapse {% if ns.expanded %}show{% endif %}"
                        data-parent="#corpus_list">
                        {% for row in data.corpora[corpus.id].data.values() %}
                        <a class="list-group-item list-group-item-action {% if data.chapter.id == row.id %} active{% endif %}"
                            href="{{url_for('show_corpus', corpus_id=corpus.id, chapter_id=row.id)}}">
                            {{row.name}}
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% if ns.expanded %}{% set ns.expanded = false %}{% endif %}
                {% endfor %}
            </div>
        </div>
        <div class="col-sm">
            {% if data.chapter %}
            <div class="card d-flex flex-column">
                <div class="card-header lead">
                    {{data.chapter.name}}
                </div>
                <div id="audio-container" class="card-body bg-light border-bottom">
                    <audio controls id="audio" src="{{data.audio}}"></audio>
                </div>
                <div id="text-container" class="card-body scroll">
                    {% for paragraph in data.content %}
                    <p>
                        {% for line in paragraph %}
                        <span class="my-1">
                            {% for word in line %}
                            <span class="align-text m-0" data-begin="{{word.begin}}" data-end="{{word.end}}">
                                {{word.lines | join(' ')}}
                            </span>
                            {% endfor %}
                            <br>
                        </span>
                        {% endfor %}
                    </p>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            {% for corpus in data.corpora.values() %}
            <div class="row pb-2">
                <div class="col-sm">
                    <div class="card">
                        <div class="card-header lead">
                            {{corpus.name}}
                        </div>
                        <div class="card-body">
                            {{corpus.description | safe}}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </div>
    </div>
</div>
<script>
    var scrolls = document.getElementsByClassName('scroll');
    for (const scroll of scrolls) {
        //Get the distance from the top and add 20px for the padding
        var maxHeight = scroll.getBoundingClientRect().top + 20;
        scroll.style.height = "calc(100vh - " + maxHeight + "px)";
    }
</script>
<script src="{{url_for('static', filename='js/align.js')}}"></script>
{% include "footer.html" %}